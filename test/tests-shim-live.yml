base_url: "https://mail.example.com"   # overridden by SHIM_TEST_BASE_URL via make test-rest-shim-env
verify_tls: false

defaults:
  headers:
    Content-Type: "application/x-www-form-urlencoded"

tests:
  - name: "Shim Ping"
    method: POST
    path: /service/extension/zpush-shim
    body: action=ping
    expect:
      status: 200
      contains: '"status":"ok"'

  - name: "Shim Authenticate"
    method: POST
    path: /service/extension/zpush-shim
    body: "action=authenticate&username=${SHIM_TEST_USER}&password=${SHIM_TEST_PASSWORD}&protocol=eas"
    expect:
      status: 200
      json:
        success: true
    capture:
      authToken: authToken

  - name: "Shim Get User Info"
    method: POST
    path: /service/extension/zpush-shim
    body: "action=getuserinfo&authToken=${authToken}"
    expect:
      status: 200
      contains: '"displayName"'

  - name: "Shim Get Folders"
    method: POST
    path: /service/extension/zpush-shim
    body: "action=getfolders&authToken=${authToken}"
    expect:
      status: 200
      contains: '"Inbox"'
